#code to append:

if (!require("pacman")) install.packages("pacman")
pacman::p_load(gganimate,gifski, transformr, ggmap,maps, hrbrthemes,viridis, scales,lubridate,RCurl, sf, hrbrthemes, lwgeom, rgdal, broom, wesanderson, rnaturalearth, maps, mapdata, spData, tigris, tidycensus, leaflet, tmap, tmaptools, tidyverse, rvest, polite, readr, knitr, readxl)

# First, I want to obtain the data about covid and provinces in Spain
x <- getURL("https://raw.githubusercontent.com/montera34/escovid19data/master/data/output/covid19-provincias-spain_consolidated.csv")
data_province <- read.csv(text = x)

data_province<-data_province%>%rename(region=ine_code)

data_province$date<-as.POSIXct(data_province$date)
data_province$date<-as.Date(data_province$date)
sapply(data_province, class)

#Now I want to generate a dataframe of only one day in order to generate the database for the map

data_province$cases_per_100mil <- (data_province$num_casos_prueba_pcr_avg7/data_province$poblacion)* 100000

single_january <- subset(data_province, date=="2020-01-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")

#generate the number of cases per 100000 using PCR


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_january<-single_january %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_january, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = C), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



January_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="January, 2020-01-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_january <- subset(data_province, date=="2020-01-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_january<-single_january %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_january, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



January_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="January, 2020-01-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_january <- subset(data_province, date=="2020-01-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_january<-single_january %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_january, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



January_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="January, 2020-01-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()




single_February <- subset(data_province, date=="2020-02-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February, 2020-02-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February, 2020-02-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_February <- subset(data_province, date=="2020-02-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February, 2020-02-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_March <- subset(data_province, date=="2020-03-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_March <- subset(data_province, date=="2020-03-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()




single_April <- subset(data_province, date=="2020-04-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April, 2020-04-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_April <- subset(data_province, date=="2020-04-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April, 2020-04-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April, 2020-04-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()




single_May <- subset(data_province, date=="2020-05-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_May <- subset(data_province, date=="2020-05-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()













single_June <- subset(data_province, date=="2020-06-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June, 2020-06-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_June <- subset(data_province, date=="2020-06-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June, 2020-06-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_June <- subset(data_province, date=="2020-06-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June, 2020-06-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()
















single_July <- subset(data_province, date=="2020-07-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July, 2020-07-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July, 2020-07-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July, 2020-07-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()
















single_August <- subset(data_province, date=="2020-08-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August, 2020-08-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_August <- subset(data_province, date=="2020-08-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August, 2020-08-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_August <- subset(data_province, date=="2020-08-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August, 2020-08-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()





single_September <- subset(data_province, date=="2020-09-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()




single_September <- subset(data_province, date=="2020-09-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_September <- subset(data_province, date=="2020-09-03" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_03<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-03",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_September <- subset(data_province, date=="2020-09-04" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_04<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-04",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_September <- subset(data_province, date=="2020-09-05" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_05<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-05",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_September <- subset(data_province, date=="2020-09-06" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_06<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-06",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_September <- subset(data_province, date=="2020-09-07" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_07<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-07",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-08" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_08<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-08",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_September <- subset(data_province, date=="2020-09-09" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_09<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-09",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_September <- subset(data_province, date=="2020-09-10" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_10<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-10",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-11" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_11<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-11",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-12" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_12<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-12",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-13" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_13<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-13",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-14" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_14<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-14",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-15" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_15<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-15",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-16" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_16<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-16",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_September <- subset(data_province, date=="2020-09-18" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_18<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-18",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_September <- subset(data_province, date=="2020-09-19" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_19<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-19",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-20" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_20<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-20",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-21" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_21<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-21",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-22" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_22<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-22",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-23" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_23<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-23",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-24" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_24<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-24",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-25" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_25<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-25",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-26" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_26<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-26",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-27" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_27<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-27",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()




single_February <- subset(data_province, date=="2020-02-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_February <- subset(data_province, date=="2020-02-03" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_03<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-03",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_February <- subset(data_province, date=="2020-02-04" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_04<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-04",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_February <- subset(data_province, date=="2020-02-05" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_05<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-05",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_February <- subset(data_province, date=="2020-02-06" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_06<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-06",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_February <- subset(data_province, date=="2020-02-07" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_07<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-07",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-08" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_08<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-08",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_February <- subset(data_province, date=="2020-02-09" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_09<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-09",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_February <- subset(data_province, date=="2020-02-10" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_10<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-10",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-11" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_11<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-11",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-12" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_12<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-12",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-13" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_13<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-13",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-14" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_14<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-14",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-15" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_15<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-15",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-16" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_16<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-16",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_February <- subset(data_province, date=="2020-02-18" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_18<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-18",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_February <- subset(data_province, date=="2020-02-19" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_19<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-19",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-20" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_20<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-20",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-21" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_21<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-21",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-22" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_22<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-22",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-23" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_23<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-23",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-24" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_24<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-24",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-25" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_25<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-25",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-26" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_26<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-26",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-27" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_27<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-27",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_February <- subset(data_province, date=="2020-02-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_February<-single_February %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_February, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



February_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="February,2020-02-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_March <- subset(data_province, date=="2020-03-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_March <- subset(data_province, date=="2020-03-03" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_03<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-03",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_March <- subset(data_province, date=="2020-03-04" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_04<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-04",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_March <- subset(data_province, date=="2020-03-05" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_05<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-05",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_March <- subset(data_province, date=="2020-03-06" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_06<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-06",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_March <- subset(data_province, date=="2020-03-07" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_07<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-07",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-08" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_08<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-08",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_March <- subset(data_province, date=="2020-03-09" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_09<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-09",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_March <- subset(data_province, date=="2020-03-10" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_10<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-10",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-11" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_11<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-11",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-12" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_12<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-12",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-13" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_13<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-13",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-14" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_14<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-14",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-15" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_15<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-15",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-16" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_16<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-16",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_March <- subset(data_province, date=="2020-03-18" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_18<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-18",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_March <- subset(data_province, date=="2020-03-19" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_19<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-19",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-20" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_20<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-20",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-21" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_21<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-21",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-22" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_22<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-22",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-23" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_23<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-23",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-24" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_24<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-24",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-25" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_25<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-25",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-26" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_26<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-26",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-27" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_27<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-27",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_March <- subset(data_province, date=="2020-03-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_March<-single_March %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_March, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



March_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="March,2020-03-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_April <- subset(data_province, date=="2020-04-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_April <- subset(data_province, date=="2020-04-03" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_03<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-03",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_April <- subset(data_province, date=="2020-04-04" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_04<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-04",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_April <- subset(data_province, date=="2020-04-05" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_05<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-05",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_April <- subset(data_province, date=="2020-04-06" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_06<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-06",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_April <- subset(data_province, date=="2020-04-07" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_07<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-07",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-08" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_08<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-08",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_April <- subset(data_province, date=="2020-04-09" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_09<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-09",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_April <- subset(data_province, date=="2020-04-10" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_10<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-10",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-11" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_11<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-11",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-12" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_12<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-12",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-13" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_13<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-13",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-14" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_14<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-14",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-15" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_15<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-15",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-16" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_16<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-16",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_April <- subset(data_province, date=="2020-04-18" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_18<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-18",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_April <- subset(data_province, date=="2020-04-19" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_19<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-19",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-20" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_20<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-20",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-21" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_21<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-21",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-22" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_22<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-22",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-23" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_23<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-23",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-24" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_24<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-24",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-25" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_25<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-25",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-26" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_26<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-26",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-27" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_27<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-27",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_April <- subset(data_province, date=="2020-04-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_April<-single_April %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_April, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



April_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="April,2020-04-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_May <- subset(data_province, date=="2020-05-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_May <- subset(data_province, date=="2020-05-03" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_03<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-03",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_May <- subset(data_province, date=="2020-05-04" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_04<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-04",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_May <- subset(data_province, date=="2020-05-05" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_05<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-05",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_May <- subset(data_province, date=="2020-05-06" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_06<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-06",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_May <- subset(data_province, date=="2020-05-07" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_07<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-07",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-08" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_08<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-08",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_May <- subset(data_province, date=="2020-05-09" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_09<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-09",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_May <- subset(data_province, date=="2020-05-10" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_10<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-10",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-11" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_11<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-11",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-12" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_12<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-12",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-13" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_13<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-13",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-14" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_14<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-14",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-15" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_15<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-15",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-16" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_16<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-16",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_May <- subset(data_province, date=="2020-05-18" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_18<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-18",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_May <- subset(data_province, date=="2020-05-19" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_19<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-19",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-20" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_20<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-20",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-21" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_21<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-21",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-22" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_22<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-22",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-23" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_23<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-23",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-24" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_24<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-24",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-25" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_25<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-25",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-26" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_26<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-26",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-27" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_27<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-27",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_May <- subset(data_province, date=="2020-05-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_May<-single_May %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_May, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



May_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="May,2020-05-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_June <- subset(data_province, date=="2020-06-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_June <- subset(data_province, date=="2020-06-03" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_03<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-03",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_June <- subset(data_province, date=="2020-06-04" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_04<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-04",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_June <- subset(data_province, date=="2020-06-05" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_05<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-05",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_June <- subset(data_province, date=="2020-06-06" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_06<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-06",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_June <- subset(data_province, date=="2020-06-07" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_07<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-07",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-08" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_08<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-08",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_June <- subset(data_province, date=="2020-06-09" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_09<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-09",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_June <- subset(data_province, date=="2020-06-10" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_10<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-10",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-11" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_11<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-11",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-12" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_12<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-12",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-13" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_13<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-13",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-14" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_14<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-14",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-15" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_15<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-15",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-16" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_16<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-16",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_June <- subset(data_province, date=="2020-06-18" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_18<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-18",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_June <- subset(data_province, date=="2020-06-19" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_19<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-19",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-20" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_20<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-20",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-21" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_21<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-21",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-22" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_22<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-22",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-23" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_23<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-23",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-24" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_24<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-24",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-25" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_25<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-25",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-26" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_26<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-26",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-27" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_27<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-27",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_June <- subset(data_province, date=="2020-06-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_June<-single_June %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_June, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



June_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="June,2020-06-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_July <- subset(data_province, date=="2020-07-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_July <- subset(data_province, date=="2020-07-03" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_03<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-03",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_July <- subset(data_province, date=="2020-07-04" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_04<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-04",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_July <- subset(data_province, date=="2020-07-05" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_05<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-05",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_July <- subset(data_province, date=="2020-07-06" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_06<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-06",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_July <- subset(data_province, date=="2020-07-07" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_07<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-07",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-08" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_08<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-08",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_July <- subset(data_province, date=="2020-07-09" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_09<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-09",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_July <- subset(data_province, date=="2020-07-10" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_10<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-10",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-11" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_11<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-11",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-12" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_12<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-12",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-13" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_13<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-13",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-14" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_14<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-14",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-15" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_15<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-15",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-16" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_16<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-16",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_July <- subset(data_province, date=="2020-07-18" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_18<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-18",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_July <- subset(data_province, date=="2020-07-19" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_19<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-19",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-20" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_20<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-20",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-21" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_21<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-21",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-22" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_22<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-22",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-23" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_23<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-23",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-24" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_24<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-24",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-25" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_25<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-25",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-26" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_26<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-26",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-27" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_27<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-27",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_July <- subset(data_province, date=="2020-07-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_July<-single_July %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_July, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



July_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="July,2020-07-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_August <- subset(data_province, date=="2020-08-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_August <- subset(data_province, date=="2020-08-03" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_03<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-03",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_August <- subset(data_province, date=="2020-08-04" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_04<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-04",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_August <- subset(data_province, date=="2020-08-05" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_05<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-05",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_August <- subset(data_province, date=="2020-08-06" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_06<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-06",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_August <- subset(data_province, date=="2020-08-07" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_07<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-07",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-08" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_08<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-08",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_August <- subset(data_province, date=="2020-08-09" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_09<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-09",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_August <- subset(data_province, date=="2020-08-10" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_10<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-10",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-11" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_11<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-11",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-12" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_12<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-12",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-13" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_13<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-13",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-14" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_14<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-14",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-15" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_15<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-15",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-16" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_16<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-16",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_August <- subset(data_province, date=="2020-08-18" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_18<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-18",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_August <- subset(data_province, date=="2020-08-19" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_19<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-19",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-20" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_20<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-20",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-21" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_21<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-21",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-22" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_22<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-22",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-23" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_23<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-23",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-24" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_24<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-24",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-25" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_25<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-25",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-26" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_26<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-26",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-27" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_27<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-27",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_August <- subset(data_province, date=="2020-08-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_August<-single_August %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_August, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



August_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="August,2020-08-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()













single_September <- subset(data_province, date=="2020-09-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_September <- subset(data_province, date=="2020-09-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_September <- subset(data_province, date=="2020-09-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_September<-single_September %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_September, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



September_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="September,2020-09-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

















single_October <- subset(data_province, date=="2020-10-01" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = "grey"),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_01<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October, 2020-10-01",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_October <- subset(data_province, date=="2020-10-02" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_02<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-02",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_October <- subset(data_province, date=="2020-10-03" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_03<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-03",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_October <- subset(data_province, date=="2020-10-04" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_04<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-04",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_October <- subset(data_province, date=="2020-10-05" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_05<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-05",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_October <- subset(data_province, date=="2020-10-06" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_06<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-06",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_October <- subset(data_province, date=="2020-10-07" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_07<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-07",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-08" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_08<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-08",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_October <- subset(data_province, date=="2020-10-09" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_09<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-09",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()



single_October <- subset(data_province, date=="2020-10-10" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_10<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-10",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-11" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_11<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-11",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-12" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_12<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-12",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-13" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_13<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-13",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-14" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_14<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-14",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-15" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_15<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-15",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-16" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_16<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-16",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-17" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_17<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-17",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_October <- subset(data_province, date=="2020-10-18" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_18<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-18",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()


single_October <- subset(data_province, date=="2020-10-19" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_19<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-19",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-20" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_20<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-20",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-21" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_21<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-21",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-22" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_22<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-22",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-23" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_23<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-23",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-24" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_24<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-24",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-25" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_25<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-25",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-26" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_26<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-26",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-27" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_27<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-27",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

single_October <- subset(data_province, date=="2020-10-28" )

#now I want to get the spain map
#To complete this task, I am going to rely on https://github.com/aaumaitre/maps_Spain

# read the province shapefile:

#https://rstudio-pubs-static.s3.amazonaws.com/571210_03ab303e7b934a8aa9c6e9d676edf16f.html

sf_regional <- readOGR("C:\\Users\\Usuario\\Desktop\\covid_momo\\Provincias_ETRS89_30N\\Provincias_ETRS89_30N.shp")


#Convert it to a dataframe by using the tidy function of the broom package:

provinces <- tidy(sf_regional)

# recover row names

nombres_provincias <- data.frame(sf_regional$Texto)
head(nombres_provincias)
# Create and append id
nombres_provincias$id <- as.character(seq(0, nrow(nombres_provincias)-1))
#Joining
regional_df2 <- left_join(provinces, nombres_provincias, by="id")

regional_df2 <-regional_df2 %>% rename(region=id)
sapply(regional_df2, class)

#now, since the region is not of integer type, we have to write it as numeric if we want to sumar 1

regional_df2$region = as.numeric(as.character(regional_df2$region))

sapply(regional_df2, class)

single_October<-single_October %>% mutate(region=region)
regional_df2<-regional_df2 %>% mutate(region=region+1)

#joining with the regional df
regional_plot <- regional_df2%>%
  left_join(single_October, by = "region")

regional_plot%>%ggplot(aes(x=long, y = lat, group = group))+
  geom_polygon(aes(fill = cases_per_100mil), color = "white")+
  theme_minimal()
#
#
# The Theme:

theme_ari_maps <- function(...) {
  theme_minimal() +
    theme(
      axis.line = element_blank(),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      panel.grid.major = element_line(color = "#ebebe5", size = 0.2),
      panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "ivory1", color = NA),
      panel.background = element_rect(fill = "ivory1", color = NA),
      legend.background = element_rect(fill = "ivory1", color = NA),
      panel.border = element_blank(),
      plot.title = element_text(size = 11, hjust = 0.5, face = "bold"),
      plot.subtitle = element_text(size = 9, hjust = 0.5, color = "grey40"),
      plot.caption = element_text(size = 7.5, color = "grey40"),
      legend.title = element_text(color = "grey40", size = 8),
      legend.text = element_text(color = "grey40", size = 7, hjust = 0),
      legend.position = c(0.7, 0.07),
      legend.text.align = 0,
      plot.margin = unit(c(.5,.5,.2,.5), "cm"),
      panel.spacing = unit(c(2,0.2,.2,0.2), "cm"))
}

# The Colors:

pal <- wes_palette("Zissou1", 5, type = "discrete")

#Getting the quantiles:
quantile(regional_plot$cases_per_100mil, probs = c(.2,.4,.6,.8), na.rm = TRUE)
#This returns  57.7  97.0 130.7 203.4 

#I'm going to slightly change the breaks to make them prettier
#again, this fully depends on your preferences
pretty_breaks <- c( 1 ,10, 20, 30 )

# Getting the minimum and maximum value to surround the breaks
minVal <- min(regional_plot$cases_per_100mil, na.rm = T)
maxVal <- max(regional_plot$cases_per_100mil, na.rm = T)

#Putting them together:
brks <- c(minVal, pretty_breaks, maxVal)

# Creating labels
labels <- c()
# round the extremes
for(idx in 1:length(brks)){
  labels <- c(labels,round(brks[idx + 1], 2))
}

labels <- labels[1:length(labels)-1]

regional_plot$brks <- cut(regional_plot$cases_per_100mil, 
                          breaks = brks, 
                          include.lowest = TRUE, 
                          labels = labels)

brks_scale <- levels(regional_plot$brks)
labels_scale <- rev(brks_scale)



October_28<-regional_plot%>%
  #you should be using the following aesthetics for any plot you make:
  ggplot(aes(x=long, y = lat, group = group))+
  #we use brks for the fill and resuce the size of the borders
  geom_polygon(aes(fill=brks), color = "grey", size = 0.3)+
  #Adding the color palette 
  #AND setting how I want the scale to look like
  scale_fill_manual(
    values = rev(pal), #I use rev so that red is for lowest values 
    breaks = rev(brks_scale),
    name = "Daily Cases",
    drop = FALSE,
    labels = c(">30", 30,20,10,1 ),
    guide = guide_legend(direction = "horizontal",
                         keyheight = unit(2, units = "mm"),
                         keywidth = unit(50 / length(labels), units = "mm"),
                         title.position = 'top',
                         title.hjust = 0.5,
                         label.hjust = 1,
                         nrow = 1,
                         byrow = T,
                         reverse = T,
                         label.position = "bottom"))+
  labs(title="Covid in Spain: Daily Cases (per 100.000) PCR 7 Days Avg",
       subtitle="October,2020-10-28",
       caption = "Jesus Estevez-Sanchez - Data: escovid19data")+
  theme_ari_maps()

October_17

















February_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "b19February_019.png", height = 5, width = 6)
February_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "b23February_23.png", height = 5, width = 6)
February_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "b27February_27.png", height = 5, width = 6)
March_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "c3March_03.png", height = 5, width = 6)
March_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "c7March_07.png", height = 5, width = 6)
March_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "c11March_11.png", height = 5, width = 6)
March_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "c15March_015.png", height = 5, width = 6)
March_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "c19March_019.png", height = 5, width = 6)
March_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "c23March_23.png", height = 5, width = 6)
March_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "c27March_27.png", height = 5, width = 6)
April_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "d3April_03.png", height = 5, width = 6)
April_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "d7April_07.png", height = 5, width = 6)
April_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "d11April_11.png", height = 5, width = 6)
April_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "d15April_015.png", height = 5, width = 6)
April_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "d19April_019.png", height = 5, width = 6)
April_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "d23April_23.png", height = 5, width = 6)
April_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "d27April_27.png", height = 5, width = 6)
May_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "e3May_03.png", height = 5, width = 6)
May_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "e7May_07.png", height = 5, width = 6)
May_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "e11May_11.png", height = 5, width = 6)
May_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "e15May_015.png", height = 5, width = 6)
May_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "e19May_019.png", height = 5, width = 6)
May_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "e23May_23.png", height = 5, width = 6)
May_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "e27May_27.png", height = 5, width = 6)
June_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "f3June_03.png", height = 5, width = 6)
June_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "f7June_07.png", height = 5, width = 6)
June_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "f11June_11.png", height = 5, width = 6)
June_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "f15June_015.png", height = 5, width = 6)
June_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "f19June_019.png", height = 5, width = 6)
June_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "f23June_23.png", height = 5, width = 6)
June_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "f27June_27.png", height = 5, width = 6)
July_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "g3July_03.png", height = 5, width = 6)
July_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "g7July_07.png", height = 5, width = 6)
July_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "g11July_11.png", height = 5, width = 6)
July_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "g15July_015.png", height = 5, width = 6)
July_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "g19July_019.png", height = 5, width = 6)
July_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "g23July_23.png", height = 5, width = 6)
July_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "g27July_27.png", height = 5, width = 6)
August_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "h3August_03.png", height = 5, width = 6)
August_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "h7August_07.png", height = 5, width = 6)
August_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "h11August_11.png", height = 5, width = 6)
August_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "h15August_015.png", height = 5, width = 6)
August_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "h19August_019.png", height = 5, width = 6)
August_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "h23August_23.png", height = 5, width = 6)
August_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "h27August_27.png", height = 5, width = 6)
September_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "i3September_03.png", height = 5, width = 6)
September_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "i7September_07.png", height = 5, width = 6)
September_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "i11September_11.png", height = 5, width = 6)
September_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "i15September_015.png", height = 5, width = 6)
September_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "i19September_019.png", height = 5, width = 6)
September_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "i23September_23.png", height = 5, width = 6)
September_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "i27September_27.png", height = 5, width = 6)
October_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j3October_03.png", height = 5, width = 6)
October_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j4October_04.png", height = 5, width = 6)
October_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j5October_05.png", height = 5, width = 6)
October_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j6October_06.png", height = 5, width = 6)
October_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j7October_07.png", height = 5, width = 6)
October_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j8October_08.png", height = 5, width = 6)
October_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j9October_09.png", height = 5, width = 6)
October_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j10October_10.png", height = 5, width = 6)
October_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j11October_11.png", height = 5, width = 6)
October_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j12October_12.png", height = 5, width = 6)
October_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j13October_013.png", height = 5, width = 6)
October_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j14October_014.png", height = 5, width = 6)
October_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j15October_015.png", height = 5, width = 6)
October_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j16October_016.png", height = 5, width = 6)
October_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j17October_017.png", height = 5, width = 6)
October_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j18October_018.png", height = 5, width = 6)
October_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j19October_019.png", height = 5, width = 6)
October_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "j20October_20.png", height = 5, width = 6)






January_01
January_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1January_01.png", height = 5, width = 6)
January_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2January_02.png", height = 5, width = 6)
January_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3January_03.png", height = 5, width = 6)
January_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4January_04.png", height = 5, width = 6)
January_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5January_05.png", height = 5, width = 6)
January_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6January_06.png", height = 5, width = 6)
January_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7January_07.png", height = 5, width = 6)
January_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8January_08.png", height = 5, width = 6)
January_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9January_09.png", height = 5, width = 6)
January_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10January_10.png", height = 5, width = 6)
January_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11January_11.png", height = 5, width = 6)
January_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12January_12.png", height = 5, width = 6)
January_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13January_013.png", height = 5, width = 6)
January_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14January_014.png", height = 5, width = 6)
January_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15January_015.png", height = 5, width = 6)
January_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16January_016.png", height = 5, width = 6)
January_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17January_017.png", height = 5, width = 6)
January_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18January_018.png", height = 5, width = 6)
January_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19January_019.png", height = 5, width = 6)
January_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20January_20.png", height = 5, width = 6)
January_21
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "21January_21.png", height = 5, width = 6)
January_22
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "22January_22.png", height = 5, width = 6)
January_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "23January_23.png", height = 5, width = 6)
January_24
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "24January_24.png", height = 5, width = 6)
January_25
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "25January_25.png", height = 5, width = 6)
January_26
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "26January_26.png", height = 5, width = 6)
January_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "27January_27.png", height = 5, width = 6)
January_28
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "28January_28.png", height = 5, width = 6)

February_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1February_01.png", height = 5, width = 6)
February_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2February_02.png", height = 5, width = 6)
February_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3February_03.png", height = 5, width = 6)
February_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4February_04.png", height = 5, width = 6)
February_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5February_05.png", height = 5, width = 6)
February_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6February_06.png", height = 5, width = 6)
February_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7February_07.png", height = 5, width = 6)
February_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8February_08.png", height = 5, width = 6)
February_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9February_09.png", height = 5, width = 6)
February_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10February_10.png", height = 5, width = 6)
February_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11February_11.png", height = 5, width = 6)
February_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12February_12.png", height = 5, width = 6)
February_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13February_013.png", height = 5, width = 6)
February_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14February_014.png", height = 5, width = 6)
February_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15February_015.png", height = 5, width = 6)
February_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16February_016.png", height = 5, width = 6)
February_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17February_017.png", height = 5, width = 6)
February_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18February_018.png", height = 5, width = 6)
February_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19February_019.png", height = 5, width = 6)
February_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20February_20.png", height = 5, width = 6)
February_21
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "21February_21.png", height = 5, width = 6)
February_22
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "22February_22.png", height = 5, width = 6)
February_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "23February_23.png", height = 5, width = 6)
February_24
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "24February_24.png", height = 5, width = 6)
February_25
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "25February_25.png", height = 5, width = 6)
February_26
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "26February_26.png", height = 5, width = 6)
February_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "27February_27.png", height = 5, width = 6)
February_28
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "28February_28.png", height = 5, width = 6)


March_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1March_01.png", height = 5, width = 6)
March_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2March_02.png", height = 5, width = 6)
March_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3March_03.png", height = 5, width = 6)
March_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4March_04.png", height = 5, width = 6)
March_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5March_05.png", height = 5, width = 6)
March_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6March_06.png", height = 5, width = 6)
March_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7March_07.png", height = 5, width = 6)
March_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8March_08.png", height = 5, width = 6)
March_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9March_09.png", height = 5, width = 6)
March_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10March_10.png", height = 5, width = 6)
March_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11March_11.png", height = 5, width = 6)
March_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12March_12.png", height = 5, width = 6)
March_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13March_013.png", height = 5, width = 6)
March_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14March_014.png", height = 5, width = 6)
March_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15March_015.png", height = 5, width = 6)
March_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16March_016.png", height = 5, width = 6)
March_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17March_017.png", height = 5, width = 6)
March_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18March_018.png", height = 5, width = 6)
March_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19March_019.png", height = 5, width = 6)
March_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20March_20.png", height = 5, width = 6)
March_21
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "21March_21.png", height = 5, width = 6)
March_22
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "22March_22.png", height = 5, width = 6)
March_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "23March_23.png", height = 5, width = 6)
March_24
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "24March_24.png", height = 5, width = 6)
March_25
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "25March_25.png", height = 5, width = 6)
March_26
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "26March_26.png", height = 5, width = 6)
March_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "27March_27.png", height = 5, width = 6)
March_28
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "28March_28.png", height = 5, width = 6)

April_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1April_01.png", height = 5, width = 6)
April_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2April_02.png", height = 5, width = 6)
April_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3April_03.png", height = 5, width = 6)
April_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4April_04.png", height = 5, width = 6)
April_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5April_05.png", height = 5, width = 6)
April_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6April_06.png", height = 5, width = 6)
April_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7April_07.png", height = 5, width = 6)
April_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8April_08.png", height = 5, width = 6)
April_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9April_09.png", height = 5, width = 6)
April_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10April_10.png", height = 5, width = 6)
April_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11April_11.png", height = 5, width = 6)
April_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12April_12.png", height = 5, width = 6)
April_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13April_013.png", height = 5, width = 6)
April_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14April_014.png", height = 5, width = 6)
April_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15April_015.png", height = 5, width = 6)
April_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16April_016.png", height = 5, width = 6)
April_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17April_017.png", height = 5, width = 6)
April_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18April_018.png", height = 5, width = 6)
April_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19April_019.png", height = 5, width = 6)
April_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20April_20.png", height = 5, width = 6)
April_21
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "21April_21.png", height = 5, width = 6)
April_22
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "22April_22.png", height = 5, width = 6)
April_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "23April_23.png", height = 5, width = 6)
April_24
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "24April_24.png", height = 5, width = 6)
April_25
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "25April_25.png", height = 5, width = 6)
April_26
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "26April_26.png", height = 5, width = 6)
April_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "27April_27.png", height = 5, width = 6)
April_28
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "28April_28.png", height = 5, width = 6)

May_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1May_01.png", height = 5, width = 6)
May_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2May_02.png", height = 5, width = 6)
May_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3May_03.png", height = 5, width = 6)
May_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4May_04.png", height = 5, width = 6)
May_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5May_05.png", height = 5, width = 6)
May_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6May_06.png", height = 5, width = 6)
May_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7May_07.png", height = 5, width = 6)
May_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8May_08.png", height = 5, width = 6)
May_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9May_09.png", height = 5, width = 6)
May_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10May_10.png", height = 5, width = 6)
May_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11May_11.png", height = 5, width = 6)
May_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12May_12.png", height = 5, width = 6)
May_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13May_013.png", height = 5, width = 6)
May_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14May_014.png", height = 5, width = 6)
May_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15May_015.png", height = 5, width = 6)
May_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16May_016.png", height = 5, width = 6)
May_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17May_017.png", height = 5, width = 6)
May_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18May_018.png", height = 5, width = 6)
May_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19May_019.png", height = 5, width = 6)
May_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20May_20.png", height = 5, width = 6)
May_21
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "21May_21.png", height = 5, width = 6)
May_22
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "22May_22.png", height = 5, width = 6)
May_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "23May_23.png", height = 5, width = 6)
May_24
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "24May_24.png", height = 5, width = 6)
May_25
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "25May_25.png", height = 5, width = 6)
May_26
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "26May_26.png", height = 5, width = 6)
May_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "27May_27.png", height = 5, width = 6)
May_28
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "28May_28.png", height = 5, width = 6)

June_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1June_01.png", height = 5, width = 6)
June_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2June_02.png", height = 5, width = 6)
June_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3June_03.png", height = 5, width = 6)
June_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4June_04.png", height = 5, width = 6)
June_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5June_05.png", height = 5, width = 6)
June_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6June_06.png", height = 5, width = 6)
June_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7June_07.png", height = 5, width = 6)
June_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8June_08.png", height = 5, width = 6)
June_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9June_09.png", height = 5, width = 6)
June_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10June_10.png", height = 5, width = 6)
June_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11June_11.png", height = 5, width = 6)
June_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12June_12.png", height = 5, width = 6)
June_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13June_013.png", height = 5, width = 6)
June_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14June_014.png", height = 5, width = 6)
June_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15June_015.png", height = 5, width = 6)
June_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16June_016.png", height = 5, width = 6)
June_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17June_017.png", height = 5, width = 6)
June_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18June_018.png", height = 5, width = 6)
June_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19June_019.png", height = 5, width = 6)
June_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20June_20.png", height = 5, width = 6)
June_21
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "21June_21.png", height = 5, width = 6)
June_22
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "22June_22.png", height = 5, width = 6)
June_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "23June_23.png", height = 5, width = 6)
June_24
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "24June_24.png", height = 5, width = 6)
June_25
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "25June_25.png", height = 5, width = 6)
June_26
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "26June_26.png", height = 5, width = 6)
June_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "27June_27.png", height = 5, width = 6)
June_28
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "28June_28.png", height = 5, width = 6)

July_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1July_01.png", height = 5, width = 6)
July_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2July_02.png", height = 5, width = 6)
July_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3July_03.png", height = 5, width = 6)
July_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4July_04.png", height = 5, width = 6)
July_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5July_05.png", height = 5, width = 6)
July_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6July_06.png", height = 5, width = 6)
July_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7July_07.png", height = 5, width = 6)
July_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8July_08.png", height = 5, width = 6)
July_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9July_09.png", height = 5, width = 6)
July_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10July_10.png", height = 5, width = 6)
July_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11July_11.png", height = 5, width = 6)
July_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12July_12.png", height = 5, width = 6)
July_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13July_013.png", height = 5, width = 6)
July_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14July_014.png", height = 5, width = 6)
July_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15July_015.png", height = 5, width = 6)
July_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16July_016.png", height = 5, width = 6)
July_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17July_017.png", height = 5, width = 6)
July_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18July_018.png", height = 5, width = 6)
July_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19July_019.png", height = 5, width = 6)
July_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20July_20.png", height = 5, width = 6)
July_21
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "21July_21.png", height = 5, width = 6)
July_22
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "22July_22.png", height = 5, width = 6)
July_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "23July_23.png", height = 5, width = 6)
July_24
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "24July_24.png", height = 5, width = 6)
July_25
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "25July_25.png", height = 5, width = 6)
July_26
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "26July_26.png", height = 5, width = 6)
July_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "27July_27.png", height = 5, width = 6)
July_28
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "28July_28.png", height = 5, width = 6)

August_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1August_01.png", height = 5, width = 6)
August_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2August_02.png", height = 5, width = 6)
August_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3August_03.png", height = 5, width = 6)
August_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4August_04.png", height = 5, width = 6)
August_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5August_05.png", height = 5, width = 6)
August_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6August_06.png", height = 5, width = 6)
August_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7August_07.png", height = 5, width = 6)
August_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8August_08.png", height = 5, width = 6)
August_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9August_09.png", height = 5, width = 6)
August_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10August_10.png", height = 5, width = 6)
August_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11August_11.png", height = 5, width = 6)
August_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12August_12.png", height = 5, width = 6)
August_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13August_013.png", height = 5, width = 6)
August_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14August_014.png", height = 5, width = 6)
August_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15August_015.png", height = 5, width = 6)
August_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16August_016.png", height = 5, width = 6)
August_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17August_017.png", height = 5, width = 6)
August_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18August_018.png", height = 5, width = 6)
August_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19August_019.png", height = 5, width = 6)
August_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20August_20.png", height = 5, width = 6)
August_21
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "21August_21.png", height = 5, width = 6)
August_22
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "22August_22.png", height = 5, width = 6)
August_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "23August_23.png", height = 5, width = 6)
August_24
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "24August_24.png", height = 5, width = 6)
August_25
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "25August_25.png", height = 5, width = 6)
August_26
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "26August_26.png", height = 5, width = 6)
August_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "27August_27.png", height = 5, width = 6)
August_28
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "28August_28.png", height = 5, width = 6)

September_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1September_01.png", height = 5, width = 6)
September_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2September_02.png", height = 5, width = 6)
September_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3September_03.png", height = 5, width = 6)
September_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4September_04.png", height = 5, width = 6)
September_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5September_05.png", height = 5, width = 6)
September_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6September_06.png", height = 5, width = 6)
September_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7September_07.png", height = 5, width = 6)
September_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8September_08.png", height = 5, width = 6)
September_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9September_09.png", height = 5, width = 6)
September_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10September_10.png", height = 5, width = 6)
September_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11September_11.png", height = 5, width = 6)
September_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12September_12.png", height = 5, width = 6)
September_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13September_013.png", height = 5, width = 6)
September_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14September_014.png", height = 5, width = 6)
September_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15September_015.png", height = 5, width = 6)
September_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16September_016.png", height = 5, width = 6)
September_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17September_017.png", height = 5, width = 6)
September_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18September_018.png", height = 5, width = 6)
September_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19September_019.png", height = 5, width = 6)
September_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20September_20.png", height = 5, width = 6)
September_21
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "21September_21.png", height = 5, width = 6)
September_22
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "22September_22.png", height = 5, width = 6)
September_23
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "23September_23.png", height = 5, width = 6)
September_24
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "24September_24.png", height = 5, width = 6)
September_25
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "25September_25.png", height = 5, width = 6)
September_26
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "26September_26.png", height = 5, width = 6)
September_27
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "27September_27.png", height = 5, width = 6)
September_28
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "28September_28.png", height = 5, width = 6)

October_01
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "1October_01.png", height = 5, width = 6)
October_02
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "2October_02.png", height = 5, width = 6)
October_03
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "3October_03.png", height = 5, width = 6)
October_04
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "4October_04.png", height = 5, width = 6)
October_05
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "5October_05.png", height = 5, width = 6)
October_06
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "6October_06.png", height = 5, width = 6)
October_07
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "7October_07.png", height = 5, width = 6)
October_08
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "8October_08.png", height = 5, width = 6)
October_09
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "9October_09.png", height = 5, width = 6)
October_10
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "10October_10.png", height = 5, width = 6)
October_11
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "11October_11.png", height = 5, width = 6)
October_12
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "12October_12.png", height = 5, width = 6)
October_13
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "13October_013.png", height = 5, width = 6)
October_14
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "14October_014.png", height = 5, width = 6)
October_15
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "15October_015.png", height = 5, width = 6)
October_16
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "16October_016.png", height = 5, width = 6)
October_17
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "17October_017.png", height = 5, width = 6)
October_18
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "18October_018.png", height = 5, width = 6)
October_19
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "19October_019.png", height = 5, width = 6)
October_20
ggsave(path = "C:\\Users\\Usuario\\Desktop\\covid_momo\\MoMo_Covid\\plot_to_gif", filename = "20October_20.png", height = 5, width = 6)














